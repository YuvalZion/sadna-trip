<!DOCTYPE html>
<html>
<head>
    <title>Custom Trip Planner</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA4yYlTLqQIJXb6Wn8uEKo4tUT23mR9ckw&libraries=places&callback=initMap" async defer></script>
    <style>
        #map {
            height: 500px;
            width: 75%;
            float: left;
        }
        #controls {
            width: 23%;
            float: right;
            padding: 10px;
        }
        #itinerary {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <button onclick="showRoute(1)">Day 1</button>
        <button onclick="showRoute(2)">Day 2</button>
        <button onclick="showRoute(3)">Day 3</button>
        <div id="itinerary"></div>
    </div>
    <div id="map"></div>

    <script>
        let map;
        const STARTING_POINT = { lat: -35.2809, lng: 149.1300 };
        const MAX_HOURS = 11;
        const MIN_HOURS = 10;

        let attractions = [
            { name: "Australian War Memorial", lat: -35.2764, lng: 149.1443, avgTime: 480 },
            { name: "National Gallery of Australia", lat: -35.2977, lng: 149.1366, avgTime: 420 },
            { name: "Questacon", lat: -35.2976, lng: 149.1375, avgTime: 360 },
            { name: "Parliament House", lat: -35.3081, lng: 149.1245, avgTime: 300 },
            { name: "National Zoo & Aquarium", lat: -35.2935, lng: 149.0841, avgTime: 450 },
            { name: "Mount Ainslie Lookout", lat: -35.2739, lng: 149.1502, avgTime: 300 },
            { name: "Lake Burley Griffin", lat: -35.2920, lng: 149.1340, avgTime: 390 },
            { name: "National Museum of Australia", lat: -35.2945, lng: 149.1216, avgTime: 360 },
            { name: "National Library of Australia", lat: -35.2974, lng: 149.1301, avgTime: 75 },
            { name: "Canberra Deep Space Communication Complex", lat: -35.3985, lng: 148.9819, avgTime: 120 },
            { name: "Tidbinbilla Nature Reserve", lat: -35.4653, lng: 148.9536, avgTime: 180 },
            { name: "Cockington Green Gardens", lat: -35.2304, lng: 149.0581, avgTime: 120 },
            { name: "National Arboretum Canberra", lat: -35.3019, lng: 149.0797, avgTime: 90 }
        ];

        let itineraries = {};
        let directionsRenderer;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: STARTING_POINT,
                zoom: 13
            });
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);
            createItineraries();
        }

        function calculateDistances(points) {
            return new Promise((resolve, reject) => {
                const service = new google.maps.DistanceMatrixService();
                let destinations = points.map(p => new google.maps.LatLng(p.lat, p.lng));
                service.getDistanceMatrix({
                    origins: [new google.maps.LatLng(STARTING_POINT.lat, STARTING_POINT.lng)],
                    destinations: destinations,
                    travelMode: 'DRIVING',
                    unitSystem: google.maps.UnitSystem.METRIC,
                }, (response, status) => {
                    if (status === 'OK') {
                        let results = response.rows[0].elements.map((element, index) => ({
                            ...points[index],
                            distance: element.distance.value,
                            duration: element.duration.value
                        }));
                        resolve(results);
                    } else {
                        reject(status);
                    }
                });
            });
        }

        async function createItineraries() {
            let remainingAttractions = [...attractions];
            for (let day = 1; day <= 3; day++) {
                let distances = await calculateDistances(remainingAttractions);
                distances.sort((a, b) => a.distance - b.distance);
                let dayAttractions = distances.slice(0, 3);
                dayAttractions = adjustItinerary(dayAttractions, remainingAttractions);
                itineraries[day] = dayAttractions;
                remainingAttractions = remainingAttractions.filter(attraction => !dayAttractions.some(da => da.name === attraction.name));
            }
        }

        function adjustItinerary(dayAttractions, remainingAttractions) {
            let totalTime = calculateTotalTime(dayAttractions).totalTime;
            while (totalTime > MAX_HOURS * 60) {
                // Remove the attraction with the shortest avgTime
                dayAttractions.sort((a, b) => a.avgTime - b.avgTime);
                dayAttractions.shift();
                totalTime = calculateTotalTime(dayAttractions).totalTime;
            }
            while (totalTime < MIN_HOURS * 60 && dayAttractions.length < attractions.length) {
                // Add the next closest attraction
                let nextAttraction = remainingAttractions.find(attraction => !dayAttractions.some(da => da.name === attraction.name));
                if (nextAttraction) {
                    dayAttractions.push(nextAttraction);
                    totalTime = calculateTotalTime(dayAttractions).totalTime;
                } else {
                    break;
                }
            }
            return dayAttractions;
        }

        function calculateTotalTime(dayAttractions) {
            let totalDuration = 0;
            let totalDistance = 0;
            for (let i = 0; i < dayAttractions.length; i++) {
                totalDuration += dayAttractions[i].avgTime;
                if (i > 0) {
                    totalDuration += dayAttractions[i].duration / 60; // convert to minutes
                    totalDistance += dayAttractions[i].distance / 1000; // convert to kilometers
                }
            }
            return { totalTime: totalDuration, totalDistance: totalDistance };
        }

        function showRoute(day) {
            let directionsService = new google.maps.DirectionsService();

            let dayAttractions = itineraries[day];
            if (!dayAttractions) return;

            let waypoints = dayAttractions.map(attraction => ({
                location: new google.maps.LatLng(attraction.lat, attraction.lng),
                stopover: true
            }));

            let request = {
                origin: new google.maps.LatLng(STARTING_POINT.lat, STARTING_POINT.lng),
                destination: new google.maps.LatLng(STARTING_POINT.lat, STARTING_POINT.lng),
                waypoints: waypoints,
                travelMode: google.maps.TravelMode.DRIVING
            };

            directionsService.route(request, function(result, status) {
                if (status == 'OK') {
                    directionsRenderer.setDirections(result);
                    displayItinerary(dayAttractions);
                }
            });
        }

        function displayItinerary(attractions) {
            let itineraryDiv = document.getElementById('itinerary');
            itineraryDiv.innerHTML = '';

            let { totalTime, totalDistance } = calculateTotalTime(attractions);

            attractions.forEach((attraction, index) => {
                let attractionDiv = document.createElement('div');
                attractionDiv.innerHTML = `Point ${String.fromCharCode(65 + index + 1)}: ${attraction.name} (Avg time: ${attraction.avgTime} mins)`;
                itineraryDiv.appendChild(attractionDiv);
            });

            let totalDiv = document.createElement('div');
            totalDiv.innerHTML = `<strong>Total Time:</strong> ${Math.round(totalTime / 60)} hours ${Math.round(totalTime % 60)} mins<br/><strong>Total Distance:</strong> ${totalDistance.toFixed(2)} km`;
            itineraryDiv.appendChild(totalDiv);
        }

        window.onload = initMap;
    </script>
</body>
</html>
